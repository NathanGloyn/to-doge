function Doge(a){function b(){if(!g.length)return"wow";var a=Math.floor(Math.random()*g.length);return g[a]}function c(){var c=a(".text");c.length>50&&c[0].remove();var g=a("<div />").addClass("text");g.addClass(f[Math.floor(Math.random()*f.length)]),g.addClass(e[Math.floor(Math.random()*f.length)]),g.html(b());var h=550*Math.random()+d.left;h<d.left&&(h+=d.left);var i=600*Math.random()+d.top;g.css("left",h+"px"),g.css("top",i+"px"),g.hide(),a("#doge").append(g),g.fadeIn(600)}var d,e=["red","green","blue","yellow","magenta","cyan"],f=["small","medium","big"],g=["wow","much cool","lol"],h=0;this.display=function(){a("#doge").toggle(),d=a("#doge").position(),h=a("#doge").width();for(var b=0;50>b;b++)c()}}function List(a,b){function c(a){for(var b=0;b<a.length;b++){var c=JSON.parse(a[b],reviver);c.done?f.push(c):e.push(c)}}function d(a,b){for(var c=0;c<b.length;c++)if(b[c].text==a)return b[c];return null}var e=[],f=[];this.storage=a,this.toDo=e,this.done=f,this.add=function(b){var c=new ListItemModel(b);return e.push(c),a.store(c.text,JSON.stringify(c)),c},this.markDone=function(b){var c=new Date,g=d(b,e);return f.push(g),g.done=!0,g.dateDone=c,a.store(g.text,JSON.stringify(g)),g},this.loadItems=function(){var d=b.Deferred();return a.load().then(c).then(function(){d.resolve()}),d.promise()}}function ListItemModel(a){var b=new Date;this.text=a,this.done=!1,this.dateCreated=b,this.dateDone=null}function reviver(a,b){if(""===a)return b;var c;return"string"==typeof b&&(c=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)(Z)$/.exec(b))?new Date(Date.UTC(+c[1],+c[2]-1,+c[3],+c[4],+c[5],+c[6])):b}function Storage(a,b){this.count=0,this.store=function(b,c){var d=a.child("tasks").child(b);d.set(c)},this.load=function(){var c=b.Deferred();return a.child("tasks").once("value",function(a){var b=[],d=a.val();for(property in d){var e=d[property];e=e.substring(0,e.length),b.push(e)}c.resolve(b)},function(){console.log("Loading of tasks failed")}),c.promise()}}!function(a,b){function c(){w.loadItems().then(function(){for(var a=0;a<w.toDo.length;a++)l(w.toDo[a],y),v++;for(var a=0;a<w.done.length;a++)l(w.done[a],b("#doneList"))})}function d(){console.log("Add handlers"),b("body").keypress(m),z.click(i),B.keyup(j),b("#btnAddNewItem").click(k),b("#doge").click(s),b("#submitLogin").click(e),b("#logout").click(f),console.log("Finished adding handlers")}function e(a){a.stopPropagation();var c=b("#email").val(),d=b("#password").val();console.log("Trying to log "+c+" in"),c&&d&&(console.log("Email: "+c+", Password: "+d),C.login("password",{email:c,password:d}))}function f(){console.log("log out called"),C.logout()}function g(a){var b=a?"visible":"hidden";A.css("visibility",b)}function h(a){var c=b(a.target);if(c.is(":checked")){a.stopPropagation();var d=c.attr("id"),e=b("label[for='"+d+"']").text(),f=w.markDone(e);x.display(),setTimeout(function(){q(f)},2e3)}}function i(){console.log("New item clicked"),g(!0),z.hide(),B.focus()}function j(a){13==a.keyCode&&(k(),a.stopPropagation())}function k(){var a=B.val();if(a){var b=w.add(a);l(b,y),console.log("Create new toDoList item"),v++,n()}}function l(a,b){var c=a.done?p(a):o(a);b.append(c)}function m(a){27===a.keyCode&&(n(),a.preventDefault(),a.stopPropagation())}function n(){console.log("Hide new item entry"),B.val(""),g(!1),z.show(),z.focus()}function o(c){var d=b(a.createElement("li")).append(b(a.createElement("input")).attr({id:"item-"+v,type:"checkbox"}).click(h)).append(b(a.createElement("label")).attr({"for":"item-"+v}).text(c.text));return d}function p(c){var d=b(a.createElement("li")).append(b(a.createElement("span")).text(c.text)).append(b(a.createElement("span")).text(c.dateDone.toLocaleString()).addClass("doneDate"));return d}function q(a){var c=b("label:contains('"+a.text+"')").parent();c.remove();var d=p(a);b("#doneList").append(d)}function r(){b(".tabs .tab-links a").on("click",function(a){var c=b(this).attr("href");b(".tabs "+c).show().siblings().hide(),b(this).parent("li").addClass("active").siblings().removeClass("active"),a.preventDefault()})}function s(){b("#doge div").remove(),b("#doge").toggle()}var t={},u=new Firebase("https://to-doge.firebaseio.com"),v=0,w=new List(new Storage(u,b),b),x=new Doge(b),y=b("#toDoList"),z=b("#btnNewItem"),A=b("#newItemDiv"),B=b("#txtNewItem");b(a).ready(function(){b("#doge").toggle(),r(),d(),c()});var C=new FirebaseSimpleLogin(u,function(a,c){return console.log("In callback: Error: "+a+", User: "+c),a?void alert(a):void(c?(console.log("User ID: "+c.id+", Provider: "+c.provider),t=c,console.log("logged in"),b(".tabs").show(),b(".logon").hide()):(console.log("logged out"),b(".tabs").hide(),b(".logon").show()))})}(window.document,window.jQuery);